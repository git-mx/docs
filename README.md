# docs
1.日对账单统计服务
  商城系统是一个分布式系统，根据功能拆分成很多库，日对账单需要统计用户针对日期的
  返利增加、返利扣减、电子钱包充值、电子钱包扣减，固定额度使用，临时额度使用，线上支付，线下支付
  其中返利增加和返利扣减是存储在返利库的，电子电报充值和电子钱包扣减是存在电子信用库的
  固定额度使用、临时额度使用、线上支付，线下支付是存在订单库的
  如果每次请求都组装SQL从这些业务库里面去抓数据，效率低不说，如果统计请求过多，会直接消耗这些业务库的资源
  于是我们做了一个专门的统计库和统计服务，按天定时组装SQL从这三个库区抓取数据来存储到统计库里
  然后用户的统计查询过来，直接从统计库的表里取出数据即可。统计服务涉及到多数据源的配置，需要配置一个主要的数据源
  在启动类中通过@Primary注解来指定，针对主数据源编写mapper类和mapper.xml映射文件，而其他的库如用户库，分公司库
  以及三个数据来源库都配置成非主库，这些库不用编写mapper映射而是直接使用JdbcTemplate来操作。
  定时任务中不能一次把所有的用户-分公司信息全部查出来，然后根据用户-分公司在去业务库里面抓取数据
  我们是先查出总得用户-分公司条数，然后按批次来执行查询-插入操作，每批次执行200条，
  在批次任务处理中使用大小为CPU个数的线程池来拆分任务提高执行效率，批次处理任务中需要执行3条SQL，去连3个库所以比较耗时
  通过指定CPU数量的线程池来多线程执行，可以减少CPU的线程上下文切换，显著提高执行效率。
